---
title: "Overview"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

## Cockroach and Asthma Distributions by Borough

```{r, echo = FALSE, include = FALSE}
library(tidyverse)
library(PerformanceAnalytics)
library(sf)
library(sp)
library(tmap)
library(patchwork)

tidy_asthma = 
  read_csv(file = "./final_data/tidy_asthma.csv")

tidy_asthma 

shape = st_read("./final_data/shapefiles/", quiet = TRUE)

tidy_asthma_sf = merge(shape, tidy_asthma, by.x = "UHFCODE", by.y = "geo_join_id") %>% 
  janitor::clean_names() %>% 
  mutate(uhfcode = as.character(uhfcode),
         time_period = as.character(time_period),
         homes_with_cockroaches = as.numeric(homes_with_cockroaches))

tidy_asthma_sf_ll = st_transform(tidy_asthma_sf, "+proj=longlat +datum=WGS84")
```

```{r, echo = FALSE}

p2 = 
  tidy_asthma_sf_ll %>%
  ggplot(aes(x = public_school_children_5_14_yrs_old_with_asthma)) + 
  geom_density() +
  facet_grid(~borough) +
  labs(
    x = "Percent of Public School Children with Asthma",
    y = "Frequency",
    title = "Distribution of Childhood Asthma by Borough")
p2
```

## Cockroach Prevalence by Borough Graph 
```{r, echo = FALSE}
p1 = 
  tidy_asthma_sf_ll %>%
  ggplot(aes(x = homes_with_cockroaches)) + 
  geom_density() +
  facet_grid(~borough) +
  labs(
    x = "Percent of Homes with Cockroaches",
    y = "Frequency",
    title = "Distribution of Cockroaches by Borough"
  ) 

p1
```


### Related work 

## Initial Questions 

## Data

We downloaded all available data from the [NYC Gov Environmental & Health Data Portal](http://a816-dohbesp.nyc.gov/IndicatorPublic/BuildATable.aspx). The Environmental & Health Data Portal houses data from a variety of sources such as the New York City Automated School Health Records, American Community Survey and New York City Housing and Vacancy Survey (HVS). Data from this portal are used to study how the environment affects health. We initially filtered the dataset to include all variables related to asthma, cockroaches and poverty before finalizing the dataset to include variables only related to public school children with asthma, homes with cockroaches and poverty. The asthma CSV file we used is linked (here)[asthma_data.csv]. 

  * `geo_type_name`: Geographical name (i.e borough, UHF42)
  
  * `geo_join_id`: Numeric ID of the geographical area 
  
  * `geo_place_name`: Name of the geographical area
  
  * `time_period`: Year

Predictor

  * `homes_with_cockroaches` (Percent): Estimated number of households in an 
    area that reported seeing at least one cockroach daily over the last 
    month, divided by the number of households in the area.

Outcome of interest 

  * `public_school_children_5_14_yrs_old_with_asthma` (Rate): Number of 
    public school children, aged 5-14 years, with a diagnosis of asthma that 
    has been reported to NYC DOHMH during the current or previous school 
    year, divided by the 5-14 year old population, per 1,000. 

Potential confounder

  * `poverty` (Percent): Estimated number of people for whom poverty status 
    is determined, whose annual income falls below 100% of the federal 
    poverty level, divided by the number of people for whom poverty status is
    determined.

Our github repository is linked [here](https://github.com/prisrinivasan/p8105_final)

The map was built using the United Hospital Fund (UHF) neighborhood code key from [NYC Health](http://a816-dohbesp.nyc.gov/IndicatorPublic/EPHTPDF/uhf42.pdf). 

## Exploratory analysis

### Loading and tidying the data 

We downloaded the data as a csv file from the NYC Environmental & Health Data Portal and called the initial dataset `all_available_data`. We restricted our data to include boroughs and UHF42 neighborhoods as our geographical areas of interest and to include the indicators: `homes_with_cockroaches`, `poverty` and `public_school_children_5_14_yrs_old_with_asthma`. The data for these three indicators overlapped for the years 2011-2014 so we restricted our analysis to these four years. 

Talk about recoding years, i.e. 2010-2011 --> 2011

We called the tidied dataset `tidy_asthma` and exported it as a csv file for future reference.

NOTE: I set up this header temporarily to separate it from the first section. Feel free to edit as needed.

### Analyses of the data 

* The graphs and analyses can be found [here](regression.Rmd).
* We started by creating a correlation matrix to assess multicollinearity and baseline correlations
* We then assessed the crude relationship between exposure, cockroach presence in the home and the outcome, childhood asthma


## Discussion

