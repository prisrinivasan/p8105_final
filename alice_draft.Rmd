---
title: "alice data review"
author: "Alice Tivarovsky"
date: "11/15/2019"
output: html_document
---

## Setup
```{r setup}

knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

```

## Data import and tidying

Loading in and tidying data: 
```{r}

asthma_data = read_csv(file = "./final_data/asthma_data.csv") %>% 
  janitor::clean_names() %>% 
  filter(data_value != "NULL") %>% 
  rename(year = year_description) %>% 
  mutate(
    data_value = as.numeric(data_value),
    year = as.factor(year)
    ) %>% 
  drop_na(year) %>% 
  filter(str_detect(name, c("[Aa]sthma", "[Cc]ockroaches"))) %>% 
  select(year, geo_entity_id, name, data_value) %>% 
  pivot_wider(
    names_from = name,
    values_from = data_value
  ) %>% 
  view()
 
```

Replacing NA values with averages across years using a function: 

```{r}

asthma_replace = function(x){
  
  y = mean(x, na.rm = TRUE)
  x = replace(x, is.na(x), y)
  
}

```

```{r}

asthma_data %>% 
  group_by(geo_entity_id, year) %>% 
  summarize(n = mean("Adults with Asthma in the Past 12 Months", na.rm = TRUE))

```


We removed entries that included non-numerical year values, missing values for data_value, and any indicator not containing the words "asthma", "cockroaches", or "poverty". The resulting dataset contains 2,212 entries across 9 variables. Variables are defined as follows: 

* `indicator_data_id`: unique data entry id
* `name`: 


## Trying with all available data 

```{r}

all_data = 
read.csv(file = "./final_data/all_available_data.csv") %>% 
  janitor::clean_names() %>% 
  filter(name %in% c("Adults with Asthma in the Past 12 Months","Asthma Emergency Department Visits (Adults)", "Asthma Emergency Department Visits (Children 0 to 4 Yrs Old)", "Asthma Emergency Department Visits (Children 5 to 17 Yrs Old)", "Asthma Hospitalizations (Adults)", "Asthma Hospitalizations (Children 0 to 4 Yrs Old)", "Asthma Hospitalizations (Children 5 to 17 Yrs Old)", "Children under 5 years old in Poverty", "Homes with Cockroaches", "Neighborhood Poverty", "Neighborhood Poverty (ACS)", "O3-Attributable Asthma Emergency Department Visits", "O3-Attributable Asthma Hospitalizations", "PM2.5-Attributable Asthma Emergency Department Visits", "Poverty", "Public School Children (5-14 Yrs Old) with Asthma", "Public School Children (5-14 Yrs Old) with Persistent Asthma"), 
         geo_type_name == "UHF42"
         )

```

Other way: 
```{r}
all_data_2 = 
read.csv(file = "./final_data/all_available_data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(name = as.character(name)) %>% 
  filter(str_detect(name, c("[Aa]sthma", "[Cc]ockroaches", "[Pp]overty")),
         str_detect(name, "Adults Reporting Cockroaches in the Home", negate = TRUE),
         str_detect(name, "NTA", negate = TRUE),
         geo_type_name == 'UHF42'
         )
```


```{r}
 pull(distinct(all_data, time_period))
```

Exploratory counts to verify filter steps: 

```{r}
all_data %>%  
  filter(time_period == 2003) %>% 
  group_by(name, time_period, geo_join_id) %>% 
  summarize(n = sum(data_value)) %>% 
  view()
```



Tidying: 

```{r}
all_data %>%
  select(name, geo_join_id, time_period, measure, data_value) %>% 
pivot_wider(
    names_from = name,
    values_from = data_value
  ) %>% 
view()
```

