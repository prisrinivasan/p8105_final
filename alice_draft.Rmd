---
title: "alice data review"
author: "Alice Tivarovsky"
date: "11/15/2019"
output: html_document
---

## Setup
```{r setup}

knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

```

## Data import and tidying

Loading in and tidying data: 
```{r}

asthma_data = read_csv(file = "./final_data/asthma_data.csv") %>% 
  janitor::clean_names() %>% 
  filter(data_value != "NULL") %>% 
  rename(year = year_description) %>% 
  mutate(
    data_value = as.numeric(data_value),
    year = as.factor(year)
    ) %>% 
  drop_na(year) %>% 
  filter(str_detect(name, c("[Aa]sthma", "[Cc]ockroaches"))) %>% 
  select(year, geo_entity_id, name, data_value) %>% 
  pivot_wider(
    names_from = name,
    values_from = data_value
  ) %>% 
  view()
 
```

Replacing NA values with averages across years using a function: 

```{r}

asthma_replace = function(x){
  
  y = mean(x, na.rm = TRUE)
  x = replace(x, is.na(x), y)
  
}

```

```{r}

asthma_data %>% 
  group_by(geo_entity_id, year) %>% 
  summarize(n = mean("Adults with Asthma in the Past 12 Months", na.rm = TRUE))

```


We removed entries that included non-numerical year values, missing values for data_value, and any indicator not containing the words "asthma", "cockroaches", or "poverty". The resulting dataset contains 2,212 entries across 9 variables. Variables are defined as follows: 

* `indicator_data_id`: unique data entry id
* `name`: 


## Trying with all available data 

```{r}
all_data = 
read.csv(file = "./final_data/all_available_data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(name = as.character(name)) %>% 
  filter(str_detect(name, c("[Aa]sthma", "[Cc]ockroaches", "[Pp]overty")),
         geo_type_name == 'UHF42', 
         str_detect(name, "NTA", negate = TRUE)
         ) %>% 
  select(unique_id, indicator_id, measure, name, geo_join_id, time_period, data_value) %>%
  pivot_wider(
    names_from = name,
    values_from = data_value
  ) %>% 
  group_by(time_period, geo_join_id) %>% 
  summarize(n = n())

 
```


```{r}
 pull(distinct(all_data, name))
```


