---
title: "Cockroaches and Asthma in New York City"
output: html_document
---
<center>
</font>
<br><br>

<font size="3"> _Hannah Bowlin, Lorraine Kwok, Priyanka Srinivasan, Alice Tivarovsky, Kelly Wang_ </font>
<br><br>
<img align="center" img src="images/kids.jpg" style="width:74%"/>  
<font size = "0.7">Image from [Centers for Disease Control](https://www.cdc.gov/vitalsigns/childhood-asthma/index.html)</font>

</center>
</font>
<br><br>

## Motivation
Asthma is one of the most common chronic conditions in children across the United States, currently affecting more than [6 million children](https://www.aafa.org/asthma-facts/). New York City (NYC) hosts a much higher prevalence of childhood asthma [(13%)](https://www1.nyc.gov/assets/doh/downloads/pdf/epi/databrief90.pdf) than the rest of the United States [(7.5%)](https://www.cdc.gov/nchs/fastats/asthma.htm) - with children of color and low-income neighborhoods affected disproportionately: 


```{r, echo = FALSE, include = FALSE}

library(tidyverse)
library(plotly)
library(tmap)
library(sf)
library(maptools)
library(leaflet)
library(RColorBrewer)

# reading in dataset
tidy_asthma = 
  read_csv("./final_data/tidy_asthma.csv") 

# reading in shapefiles
uhf_map = 
  st_read("./final_data/shapefiles/")
str(uhf_map)

# modifying vector types for mapping
tidy_asthma_sf = merge(uhf_map, tidy_asthma, by.x = "UHFCODE", by.y = "geo_join_id") %>% 
  janitor::clean_names() %>% 
  mutate(uhfcode = as.character(uhfcode),
         time_period = as.character(time_period),
         homes_with_cockroaches = as.numeric(homes_with_cockroaches))

#changing geometry to latitude and longitude
tidy_asthma_sf_ll = st_transform(tidy_asthma_sf, "+proj=longlat +datum=WGS84")

# natural breaks for cockroaches
cut(tidy_asthma$homes_with_cockroaches, 6) 
roach_bins = c(0, 5, 15, 25, 35, 40, 50)

#creating color palette for cockroaches
roach_pal = colorBin("Reds", bins = roach_bins)

# natural breaks for asthma
cut(tidy_asthma$public_school_children_5_14_yrs_old_with_asthma, 6) 
asthma_bins = c(0, 35, 55, 75, 95, 115, 150)

#color palette for asthma
asthma_pal = colorBin("Reds", bins = asthma_bins)

```

```{r, eval = TRUE}

#FIX LEGEND
asthma_map = 
tidy_asthma_sf_ll %>%
  filter(time_period == 2014) %>% 
  mutate(asthma_label = str_c("Children 5-14 with Asthma: ", public_school_children_5_14_yrs_old_with_asthma, "\n, Neighborhood: ", uhf_neigh)) %>% 
    leaflet() %>%
    addProviderTiles("CartoDB.Positron") %>%
    addPolygons(stroke = TRUE,
                weight = 2, 
                opacity = 1,
                color = ~asthma_pal(public_school_children_5_14_yrs_old_with_asthma),
                fillOpacity = 0.8,
                smoothFactor = 0.2,
                highlight = highlightOptions(weight = 3,
                                             color = "white",
                                             bringToFront = TRUE),
                label = ~asthma_label) %>% 
    addLegend("topleft",
              pal = asthma_pal,
              values = ~public_school_children_5_14_yrs_old_with_asthma,
              title = "Children 5-14 with Asthma (rate per 1000)",
              opacity = 1)
asthma_map
```

Aside from creating a financial [burden](https://www.ajmc.com/newsroom/cdc-study-puts-economic-burden-of-asthma-at-more-than-80-billion-per-year) for the US economy and families, asthma leads to student absenteeism, further perpetuating educational gaps and socioeconomic disparities. It has been estimated that [14 - 18%](https://www.cdc.gov/pcd/issues/2019/19_0074.htm) of missed school days are explained by asthma episodes, making asthma one of the top causes of absenteeism. 

The toll of asthma on children has drawn attention and resources towards mitigation. While root causes of asthma are still [unknown](https://www1.nyc.gov/site/doh/health/health-topics/asthma.page), common triggers - particularly those associated with allergens - have been isolated. Household pests, including cockroaches and mice, are one of the most [common indoor triggers](https://www.cdc.gov/asthma/triggers_indoor.html). 

The analyses presented here explore the association between childhood asthma and another highly prevalent NYC phenomenon - cockroaches. In 2017, 15.6% of households [reported](http://www.sternenvironmental.com/blog/2017/04/18/nyc-breaks-the-top-ten-list-for-worst-rat-and-cockroach-problems/) having pest infestations. As temperatures rise, cockroach populations are [expected](https://gothamist.com/arts-entertainment/its-summer-in-nyc-and-the-cockroaches-have-taken-flight) to increase, posing additional public health challenges, particularly among those who have asthma or respiratory reactions to cockroaches. The prevalence of homes with cockroaches, measured as number of households in an area that reported seeing at least one cockroach daily over the last month divided by number households in the area, is shown below. 


```{r, eval = TRUE}

#FIX LEGEND
roach_map = 
tidy_asthma_sf_ll %>%
  filter(time_period == 2014) %>% 
  mutate(roach_label = str_c("Homes with Cockroaches: ", homes_with_cockroaches, "\n, Neighborhood: ", uhf_neigh)) %>% 
    leaflet() %>%
    addProviderTiles("CartoDB.Positron") %>%
    addPolygons(stroke = TRUE,
                weight = 2, 
                opacity = 1,
                color = ~roach_pal(homes_with_cockroaches),
                fillOpacity = 0.8,
                smoothFactor = 0.2,
                highlight = highlightOptions(weight = 3,
                                             color = "white",
                                             bringToFront = TRUE),
                label = ~roach_label) %>% 
    addLegend("topleft",
              pal = roach_pal,
              values = ~homes_with_cockroaches,
              title = "Homes with Cockroaches",
              opacity = 1, 
              labFormat = function(type, cuts, p) {
                n = length(cuts)
                paste0(round(cuts, 1)[-n], " &ndash; ", round(cuts, 1)[-1], "%")
                })
roach_map
```


Asthma and cockroaches appear correlated - are they? 

## Data
All data used for these analyses were taken from the NYC Health Department [Environment and Health Data Portal](http://a816-dohbesp.nyc.gov/IndicatorPublic/BuildATable.aspx). Asthma and cockroach prevalence came from the ["All Available Data"](http://a816-dohbesp.nyc.gov/IndicatorPublic/EPHTCsv/AllAvailableData.zip) dataset. Spatial geometries were taken from the NYC Health Department's [GIS Center](https://www1.nyc.gov/site/doh/data/health-tools/maps-gis-data-files-for-download.page). Analyses focused on asthma prevalence in public school children aged 5 - 14. 

## Findings
Overall, a strong positive correlation was observed between asthma and cockroaches. The highest asthma rates were observed among children in the Bronx. The highest proportion of homes with cockroaches was also observed in the Bronx. Furthermore, the strongest correlation between asthma and cockroaches was observed in the Bronx. 

Potential confounding by poverty was explored and found to... Interactions between poverty and cockroaches were also explored. 

The main limitation was not including all potential confounding by sociodemographic risk factors. 

## Screencast

## Got 'Roaches? 
If you find yourself sharing space with cockroaches, the best thing you can do is to make your home as unappealing to them as possible. We recommend using humane and sustainable methods. More information can be found [here](https://www.peta.org/issues/wildlife/dealing-household-guests/cockroaches/). 

<center><img src="images/roach_hex.png" style="width:15%"/></center>






