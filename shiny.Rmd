---
title: "Shiny Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE, echo=FALSE}
library(flexdashboard)
library(tidyverse)
library(viridis)
library(leaflet)
library(plotly)
library(shiny)
library(sf)
library(tmap)
```

Column {.sidebar}
-----------------------------------------------------------------------

```{r}
tidy_asthma = read_csv(file = "./final_data/tidy_asthma.csv")

shape = st_read("./final_data/shapefiles/", quiet = TRUE)

tidy_asthma_sf = merge(shape, tidy_asthma, by.x = "UHFCODE", by.y = "geo_join_id") %>% 
  janitor::clean_names() %>% 
  mutate(uhfcode = as.character(uhfcode),
         time_period = as.character(time_period))

year = as.character(c("2011", "2012", "2013", "2014"))
# selectInput widget to sidebar
selectInput(
  "year", 
  label = h3("Select Year"),
  choices = year,
  selected = "2011")

#I (priyanka) didn't put the neighborhood names in yet, but we can replace the geo_join_id with those once we do
neighborhood = tidy_asthma_sf %>% distinct(uhfcode) %>% pull(uhfcode)
neighborhood = as.character(neighborhood)

# radioButtons widget
radioButtons(
  "neighborhood", 
  label = h3("Choose neighborhood"),
  choices = neighborhood,
  selected = "501")

```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A
### This produces a map, but not one that tells anything interesting yet
```{r map}
#what I would put in UI file
leafletOutput("tmap")

#what I would put in server file
renderLeaflet({
  
  tmap = tm_shape(tidy_asthma_sf %>%
                    filter(uhfcode == input$neighborhood,
                           time_period == input$year)) +
    tm_polygons("homes_with_cockroaches",
                legend.title = "Roach Levels in NYC Neighborhoods")
  
  tmap_leaflet(tmap)
})
```
