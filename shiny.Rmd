---
title: "Cockroach Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    source_code: embed
runtime: shiny
---

```{r, include=FALSE, echo=FALSE}
library(flexdashboard)
library(tidyverse)
library(viridis)
library(leaflet)
library(plotly)
library(shiny)
library(sf)
library(tmap)
library(devtools)
library(rsconnect)

```

Column {.sidebar}
-----------------------------------------------------------------------

```{r}
tidy_asthma = read_csv(file = "./final_data/tidy_asthma.csv")

shape = st_read("./final_data/shapefiles/", quiet = TRUE)

tidy_asthma_sf = merge(shape, tidy_asthma, by.x = "UHFCODE", by.y = "geo_join_id") %>% 
  janitor::clean_names() %>% 
  mutate(uhfcode = as.character(uhfcode),
         time_period = as.character(time_period))

year = as.character(c("2011", "2012", "2013", "2014"))

#selectInput for year choices
selectInput(
  "year", 
  label = h3("Select Year"),
  choices = year,
  selected = "2011")

#creating vector with borough names for choices
borough = c("Bronx", "Brooklyn", "Manhattan", "Queens", "Staten Island")

#function for borough choices
func = function(element, borough) {
  if(element %in% borough) {
    TRUE} else{
    FALSE
  }
}

#checkboxes
checkboxGroupInput(
  "borough", 
  label = h3("Choose borough"),
  choices = borough,
  selected = "Manhattan")

```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A
```{r}
#
tidy_asthma_sf_ll = st_transform(tidy_asthma_sf, "+proj=longlat +datum=WGS84")

#what I would put in UI file
leaf_input = reactive({
  tidy_asthma_sf_ll %>%
    mutate(borough = map(borough, func, input$borough)) %>% 
    filter(borough == TRUE,
           time_period == input$year)
})

renderLeaflet({ 
  leaf_input() %>% 
    leaflet() %>%
    addPolygons() %>%
    addTiles()
  })


#what I would put in server file
#renderLeaflet({
  
  #tmap = tm_shape(tidy_asthma_sf %>%
                    #mutate(borough = map(borough, func, input$borough)) %>% 
                    #filter(borough == TRUE,
                           #time_period == input$year)) +
    #tm_polygons("homes_with_cockroaches",
                #text = "uhf_neigh",
                #legend.title = "Roach Levels in NYC Neighborhoods")
  
  #tmap_leaflet(tmap)
#})
```
