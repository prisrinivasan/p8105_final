---
title: "priyanka"
output: html_document
---

```{r setup, message=FALSE, warning=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(viridis)
library(sf)
library(sp)
library(rvest)
library(tigris)
library(maptools)
library(ggmap)
library(broom)
library(httr)
library(rgdal)
library(sf)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_bw() + theme(legend.position = "bottom"))
```

```{r, message=FALSE, warning=FALSE}
pests_home = read_csv(file = "./final_data/mold_home.csv") %>%
  janitor::clean_names()

air_conc = read_csv(file = "./final_data/air_conc.csv") %>%
  janitor::clean_names()

mice_home = read_csv(file = "./final_data/mice_home.csv") %>%
  janitor::clean_names()

```

Reading JSON file for UHF geo
```{r, message=FALSE, warning=FALSE, echo=FALSE}
uhf <- jsonlite::fromJSON("./final_data/UHF42.json")
uhf1 <- jsonlite::fromJSON("./final_data/UHF42.json", flatten=TRUE)

```

Conclusion: the JSON file is weird, will try shape file before spending more time figuring out JSON.

# Shape files
Shape files turned out better. Used a different file from nyc.gov because the Env & Health Data Portal file was inconsistent - combined certain neighborhoods that weren't combined in the rest of the datasets.

[Source of shape files](https://www1.nyc.gov/site/doh/data/health-tools/maps-gis-data-files-for-download.page)

```{r, message=FALSE, warning=FALSE}
shape = st_read("./final_data/shapefiles/", quiet = TRUE)

#look at what we have
str(shape)

#plot all polygon boundaries
plot(shape)

#plot just geometry column
plot(st_geometry(shape))
```

Checking the `shape` tibble, it looks like the values we need are stored properly. Merged with one of our datasets below; we can change out the `air_conc` dataset with our final tidied data as long as the `geo_entity_id` is still there.

```{r, message=FALSE, warning=FALSE}
merged <- merge(shape, air_conc, by.x = "UHFCODE", by.y = "geo_entity_id")
```

```{r, message=FALSE, warning=FALSE}
#look at geometry plot
plot(st_geometry(merged))
```

I'll try a random variable, ozone, which is coded as 386 under `indicator_id`, for the a random time frame "Summer 2016": 

  * Filtered such that each UHF ID just has one observation - not totally sure but I think that is necessary.

```{r sick plot, message=FALSE, warning=FALSE}
ozone = merged %>%
  filter(indicator_id == 386 & year_description == "Summer 2016")

plot(ozone["data_value"])
```

Attempted with ggplot, but could not get the fill to differ:

```{r}
ggplot(ozone) + 
  geom_sf(aes(fill = "data_value"))
```

